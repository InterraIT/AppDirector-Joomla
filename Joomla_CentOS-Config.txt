#!/bin/bash

export PATH=$PATH:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
set -e

# More secure (recommended). Allow writting only in places Joomla! needs to write to (more secure)
#sudo chown -R root:root /var/www/html/joomla
su --session-command="chown -R root:root /var/www/html/joomla"
#cd /var/www/html/joomla
#PLACES='
#administrator/backups
#administrator/components
#administrator/modules
#administrator/templates
#cache
#components
#images
#images/banners
#images/stories
#language
#mambots
#mambots/content
#mambots/editors
#mambots/editors-xtd
#mambots/search
#media
#modules
#templates
#'
#for i in $PLACES; do
    #sudo chown -R root:root $i
#su --session-command="chown -R root:root $i"
#done



# Handle file and directory permissions:

cd /var/www/html/joomla
#sudo find . -type f -exec chmod 644 {} \;
su --session-command="find . -type f -exec chmod 644 {} \;"

#sudo find . -type d -exec chmod 755 {} \;
su --session-command="find . -type d -exec chmod 755 {} \;"


#Configure MySQL
#You need to create a new database dedicated to Joomla. You can do this with PhpMyAdmin or via the command line:
#I believe the Joomla 1.5 install does it automatically, and prompts you for a name

#mysqladmin -h localhost -u root -pmysql123 create joomla_db

#CREATING SQLscript FILE
touch joomla2.sql

#SETTING PERMISSION ON FILE
chmod 777 joomla2.sql

#SETTING PRIVILEGES TO THE USER ON DATABASE
cat <<ENDscript > joomla2.sql


GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, INDEX, ALTER, CREATE TEMPORARY TABLES, LOCK TABLES ON joomla_db.* TO 'root'@'localhost' IDENTIFIED BY 'mysql123';

exit

ENDscript

# Where joomla_db is the name you picked for the mysql database that joomla will use. You can call it anything you want.

mysql -u root -pmysql123<joomla2.sql

# You do not want to have Joomla use the mysql root user to access the database. The above command creates a mysql user (other than the mysql root user) with some priviledges to use the joomla database. You will need to chose the yourusername and yourpassword. If the command was successful, activate the new permissions:

#mysql> FLUSH PRIVILEGES;

# Quit the mysql prompt:

#mysql> \q

# Open history file for MySQL commands and delete the above SQL, since the password is in readable format!

#gedit ~/.mysql_history

#rm -rf /var/www/html/joomla/installation/